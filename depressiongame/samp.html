<!DOCTYPE html>
<html>
    <head>
        <title>Bootstrap Example</title>
          <meta charset="utf-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
        
        <script type="text/javascript">
        $(document).ready(function(){
            $("#maze").css("display","none");
            $("#imageshide").css("display","none");
                
            $("#next1").click(function(){
            $("#next1").css("display","none");
            $("#maze").css("display","block");
            openmaze();
        });
                
    });
    function openmaze() {
        
        
        startimg = document.getElementById("mainchar");
        endimg = document.getElementById("smilechar");
        
        maze = document.getElementById('maze');
        mazec = maze.getContext('2d');
        start();
        document.addEventListener("keydown", keyPush);
        document.getElementsByTagName('input')[0].addEventListener("input", newGame);
    }

    function start() {
        Difficulty = [10, 20, 50, 100];
        move = null;
        end = false;
        d = Difficulty[document.getElementsByTagName('input')[0].value];
        cols = maze.width / d;
        rows = maze.height / d;
        cells = [];
        stack = [];
        for (var x = 0; x < cols; ++x) {
            for (var y = 0; y < rows; ++y) {
                cells.push(new Cell(x, y));
            }
        }
        current = cells[cells.length - 1];
        while (buildMaze()) {}
        current = cells[cells.length - 1];
        startPoint = cells[cells.length - 1];
        endPoint = cells[0];
        path = [startPoint];
        DrawMaze();
    }


    function buildMaze() {
        current.visited = true;
        next = current.checkNeighbours();
        if (next) {
            stack.push(next);
            removeWalls(current, next);
            current = next;
        } else {
            if (stack.length > 0) {
                current = stack.pop();
            } else {
                return 0;
            }
        }
        return 1;
    }

    function DrawMaze() {
        mazec.fillStyle = '#006400';
        mazec.fillRect(0, 0, maze.width, maze.height);

        for (var x = 0; x < rows; ++x) {
            for (var y = 0; y < cols; ++y) {
                cells[x * cols + y].show();
            }
        }

        mazec.beginPath();
        mazec.strokeStyle = "#6495ed";
        mazec.lineWidth = d / 4;
        mazec.moveTo(startPoint.x + d / 2, startPoint.y + d / 2);
        for (var i = 0; i < path.length; ++i) {
            mazec.lineTo(path[i].x + d / 2, path[i].y + d / 2);
        }
        mazec.stroke();

        mazec.beginPath();
        mazec.lineWidth = 1;
        mazec.drawImage(startimg,770,460);
        mazec.fill();

        mazec.beginPath();
        mazec.drawImage(endimg,0,0);
        mazec.fillStyle = "#0c6834";
        mazec.fill();

        mazec.beginPath();
        mazec.fillStyle = "#9a1317";
        mazec.arc(current.x + d / 2, current.y + d / 2, d / 4, 0, 2 * Math.PI);
        mazec.fill();
    }

    function index(x, y) {
        if (x < 0 || y < 0 || x >= cols * d || y >= rows * d) {
            return -1;
        }
        return (y + x * rows) / d;
    }

    function Cell(x, y) {
        this.x = x * d;
        this.y = y * d;
        this.walls = [true, true, true, true]; // top -> right -> bottom -> left
        this.visited = false;

        this.show = function() {
            mazec.strokeStyle = "#003b48";
            if (this.walls[0]) { // top
                DLine(this.x, this.y, this.x + d, this.y);
            }
            if (this.walls[1]) { // right
                DLine(this.x + d, this.y, this.x + d, this.y + d);
            }
            if (this.walls[2]) { // bottom
                DLine(this.x + d, this.y + d, this.x, this.y + d);
            }
            if (this.walls[3]) { // left
                DLine(this.x, this.y + d, this.x, this.y);
            }
        }

        this.Neighbours = function() {
            var num = [];

            if (!this.walls[0]) {
                num.push(cells[index(this.x, this.y - d)]);
            }
            if (!this.walls[1]) {
                num.push(cells[index(this.x + d, this.y)]);
            }
            if (!this.walls[2]) {
                num.push(cells[index(this.x, this.y + d)]);
            }
            if (!this.walls[3]) {
                num.push(cells[index(this.x - d, this.y)]);
            }
            return num;
        }

        this.checkNeighbours = function() {
            var temp = [];
            var top = cells[index(this.x, this.y - d)];
            var right = cells[index(this.x + d, this.y)];
            var bottom = cells[index(this.x, this.y + d)];
            var left = cells[index(this.x - d, this.y)];

            if (top && !top.visited) {
                temp.push(top);
            }
            if (right && !right.visited) {
                temp.push(right);
            }
            if (bottom && !bottom.visited) {
                temp.push(bottom);
            }
            if (left && !left.visited) {
                temp.push(left);
            }
            if (temp.length > 0) {
                return temp[Math.floor(Math.random() * temp.length)];
            }
            return undefined;
        }
    }

    function removeWalls(a, b) {
        if (a.x > b.x) {
            a.walls[3] = b.walls[1] = false;
        } else if (a.x < b.x) {
            a.walls[1] = b.walls[3] = false;
        } else if (a.y > b.y) {
            a.walls[0] = b.walls[2] = false;
        } else if (a.y < b.y) {
            a.walls[2] = b.walls[0] = false;
        }
    }

    function DLine(x1, y1, x2, y2) {
        mazec.lineWidth = 3;
        mazec.beginPath();
        mazec.moveTo(x1, y1);
        mazec.lineTo(x2, y2);
        mazec.stroke();
    }

    function CheckPath(dirc) {
        if (!current.walls[dirc]) {
            var newCell;
            switch (dirc) {
                case 0: // top
                    newCell = cells[index(current.x, current.y - d)];
                    break;
                case 1: //right
                    newCell = cells[index(current.x + d, current.y)];
                    break;
                case 2: // bottom
                    newCell = cells[index(current.x, current.y + d)];
                    break;
                case 3: //left
                    newCell = cells[index(current.x - d, current.y)];
                    break;
            }
            keepMoving(newCell == path[path.length - 2], newCell);

        }
        return;
    }

    function keepMoving(dirc, n) {
        if (dirc) {
            move = setInterval(function() {
                if (!(path[path.length - 2] && path[path.length - 2].Neighbours().length < 3)) {
                    if (path[path.length - 2]) {
                        current = path[path.length - 2];
                        path.pop();
                    }
                    clearInterval(move);
                    move = null;
                } else {
                    current = path[path.length - 2];
                    path.pop();
                }
                DrawMaze();
            }, 100);

        } else {
            current = n;
            path.push(current);
            move = setInterval(function() {
                DrawMaze();
                if (!(current != endPoint && current.Neighbours().length < 3)) {
                    clearInterval(move);
                    move = null;
                    if (current == endPoint) {
                        win();
                    }
                } else {
                    if (current.Neighbours().length == 1) {
                        clearInterval(move);
                        move = null;
                    } else {
                        current = (current.Neighbours()[0] == path[path.length - 2]) ? current.Neighbours()[1] : current.Neighbours()[0];
                        path.push(current);
                    }
                }
            }, 100);

        }
    }

    function win() {
        end = true;
        mazec.font = "50px Arial";
        mazec.textAlign = "center";
        mazec.fillStyle = 'white';
        mazec.fillText("You Found Smile!", maze.width / 2, maze.height / 2);
        mazec.font = "20px Arial";
        mazec.fillText("Press space to proceed...", maze.width / 2, maze.height / 2 + 50);
    }
    function newGame(){
        $("#maze").css("display","none");
            $("#imageshide").css("display","none");
        $("#maze").css("display","block");
    }
            
    function keyPush(e) {
        if (move) {
            return;
        }
        if (e.keyCode == 38) { // top
            CheckPath(0);
        } else if (e.keyCode == 39) { // right
            CheckPath(1);
        } else if (e.keyCode == 40) { // bottom
            CheckPath(2);
        } else if (e.keyCode == 37) { // left
            CheckPath(3);
        } else if (e.keyCode == 32) { // Space
            if (end) {
                newGame();
            }
        }
    }
        </script>
    
    </head>
    <style>
        

    </style>
        
    
    <body>
        <div id=imageshide>
            <img id="mainchar" width="20" height="20" src="Pictures/mainchar.jpg" alt="player">
            <img id="smilechar" width="20" height="20" src="Pictures/smile.png" alt="player">
        </div>
        
        
        <button id="next1">click me</button>
        <!--- SsooloomM --->
        <!--- Mostafa --->
        <input type="range" min="0" max="3" value="2" step="1" style="display:none;">
        <canvas id="maze" width="800" height="500"></canvas>
        <!-- 6/2017 --->
        
        

    </body>
    
</html>